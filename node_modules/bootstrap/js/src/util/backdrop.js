/**
 * --------------------------------------------------------------------------
<<<<<<< HEAD
 * Bootstrap (v5.1.3): util/backdrop.js
=======
 * Bootstrap (v5.2.0-beta1): util/backdrop.js
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
 * --------------------------------------------------------------------------
 */

import EventHandler from '../dom/event-handler'
<<<<<<< HEAD
import { execute, executeAfterTransition, getElement, reflow, typeCheckConfig } from './index'
=======
import { execute, executeAfterTransition, getElement, reflow } from './index'
import Config from './config'

/**
 * Constants
 */

const NAME = 'backdrop'
const CLASS_NAME_FADE = 'fade'
const CLASS_NAME_SHOW = 'show'
const EVENT_MOUSEDOWN = `mousedown.bs.${NAME}`
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4

const Default = {
  className: 'modal-backdrop',
  isVisible: true, // if false, we use the backdrop helper without adding any element to the dom
  isAnimated: false,
  rootElement: 'body', // give the choice to place backdrop under different elements
  clickCallback: null
}

const DefaultType = {
  className: 'string',
  isVisible: 'boolean',
  isAnimated: 'boolean',
  rootElement: '(element|string)',
  clickCallback: '(function|null)'
}
<<<<<<< HEAD
const NAME = 'backdrop'
const CLASS_NAME_FADE = 'fade'
const CLASS_NAME_SHOW = 'show'

const EVENT_MOUSEDOWN = `mousedown.bs.${NAME}`

class Backdrop {
  constructor(config) {
=======

/**
 * Class definition
 */

class Backdrop extends Config {
  constructor(config) {
    super()
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4
    this._config = this._getConfig(config)
    this._isAppended = false
    this._element = null
  }

<<<<<<< HEAD
=======
  // Getters
  static get Default() {
    return Default
  }

  static get DefaultType() {
    return DefaultType
  }

  static get NAME() {
    return NAME
  }

  // Public
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4
  show(callback) {
    if (!this._config.isVisible) {
      execute(callback)
      return
    }

    this._append()

<<<<<<< HEAD
    if (this._config.isAnimated) {
      reflow(this._getElement())
    }

    this._getElement().classList.add(CLASS_NAME_SHOW)
=======
    const element = this._getElement()
    if (this._config.isAnimated) {
      reflow(element)
    }

    element.classList.add(CLASS_NAME_SHOW)
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4

    this._emulateAnimation(() => {
      execute(callback)
    })
  }

  hide(callback) {
    if (!this._config.isVisible) {
      execute(callback)
      return
    }

    this._getElement().classList.remove(CLASS_NAME_SHOW)

    this._emulateAnimation(() => {
      this.dispose()
      execute(callback)
    })
  }

<<<<<<< HEAD
  // Private

=======
  dispose() {
    if (!this._isAppended) {
      return
    }

    EventHandler.off(this._element, EVENT_MOUSEDOWN)

    this._element.remove()
    this._isAppended = false
  }

  // Private
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4
  _getElement() {
    if (!this._element) {
      const backdrop = document.createElement('div')
      backdrop.className = this._config.className
      if (this._config.isAnimated) {
        backdrop.classList.add(CLASS_NAME_FADE)
      }

      this._element = backdrop
    }

    return this._element
  }

<<<<<<< HEAD
  _getConfig(config) {
    config = {
      ...Default,
      ...(typeof config === 'object' ? config : {})
    }

    // use getElement() with the default "body" to get a fresh Element on each instantiation
    config.rootElement = getElement(config.rootElement)
    typeCheckConfig(NAME, config, DefaultType)
=======
  _configAfterMerge(config) {
    // use getElement() with the default "body" to get a fresh Element on each instantiation
    config.rootElement = getElement(config.rootElement)
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4
    return config
  }

  _append() {
    if (this._isAppended) {
      return
    }

<<<<<<< HEAD
    this._config.rootElement.append(this._getElement())

    EventHandler.on(this._getElement(), EVENT_MOUSEDOWN, () => {
=======
    const element = this._getElement()
    this._config.rootElement.append(element)

    EventHandler.on(element, EVENT_MOUSEDOWN, () => {
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4
      execute(this._config.clickCallback)
    })

    this._isAppended = true
  }

<<<<<<< HEAD
  dispose() {
    if (!this._isAppended) {
      return
    }

    EventHandler.off(this._element, EVENT_MOUSEDOWN)

    this._element.remove()
    this._isAppended = false
  }

=======
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4
  _emulateAnimation(callback) {
    executeAfterTransition(callback, this._getElement(), this._config.isAnimated)
  }
}

export default Backdrop
