/**
 * --------------------------------------------------------------------------
<<<<<<< HEAD
 * Bootstrap (v5.1.3): dom/selector-engine.js
=======
 * Bootstrap (v5.2.0-beta1): dom/selector-engine.js
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
 * --------------------------------------------------------------------------
 */

<<<<<<< HEAD
/**
 * ------------------------------------------------------------------------
 * Constants
 * ------------------------------------------------------------------------
 */

import { isDisabled, isVisible } from '../util/index'

const NODE_TEXT = 3
=======
import { isDisabled, isVisible } from '../util/index'

/**
 * Constants
 */
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4

const SelectorEngine = {
  find(selector, element = document.documentElement) {
    return [].concat(...Element.prototype.querySelectorAll.call(element, selector))
  },

  findOne(selector, element = document.documentElement) {
    return Element.prototype.querySelector.call(element, selector)
  },

  children(element, selector) {
<<<<<<< HEAD
    return [].concat(...element.children)
      .filter(child => child.matches(selector))
=======
    return [].concat(...element.children).filter(child => child.matches(selector))
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4
  },

  parents(element, selector) {
    const parents = []
<<<<<<< HEAD

    let ancestor = element.parentNode

    while (ancestor && ancestor.nodeType === Node.ELEMENT_NODE && ancestor.nodeType !== NODE_TEXT) {
      if (ancestor.matches(selector)) {
        parents.push(ancestor)
      }

      ancestor = ancestor.parentNode
=======
    let ancestor = element.parentNode.closest(selector)

    while (ancestor) {
      parents.push(ancestor)
      ancestor = ancestor.parentNode.closest(selector)
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4
    }

    return parents
  },

  prev(element, selector) {
    let previous = element.previousElementSibling

    while (previous) {
      if (previous.matches(selector)) {
        return [previous]
      }

      previous = previous.previousElementSibling
    }

    return []
  },
<<<<<<< HEAD

=======
  // TODO: this is now unused; remove later along with prev()
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4
  next(element, selector) {
    let next = element.nextElementSibling

    while (next) {
      if (next.matches(selector)) {
        return [next]
      }

      next = next.nextElementSibling
    }

    return []
  },

  focusableChildren(element) {
    const focusables = [
      'a',
      'button',
      'input',
      'textarea',
      'select',
      'details',
      '[tabindex]',
      '[contenteditable="true"]'
<<<<<<< HEAD
    ].map(selector => `${selector}:not([tabindex^="-"])`).join(', ')
=======
    ].map(selector => `${selector}:not([tabindex^="-"])`).join(',')
>>>>>>> 25720be54b4b3911b96b878f3e79e36853fd54b4

    return this.find(focusables, element).filter(el => !isDisabled(el) && isVisible(el))
  }
}

export default SelectorEngine
